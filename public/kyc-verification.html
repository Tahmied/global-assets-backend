<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>KYC Verification</title>
  <link rel="stylesheet" href="./css/kyc.css">
  <link rel="stylesheet" href="./css/homepage.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="./Images/favicon.ico">
</head>
<body>

  <header id="header">
    <div class="header-container">
        <div class="nav-menu">
            <div class="logo-container">
               <a href="./"> <img src="./Images/home_logo.png" alt="Company Logo"> </a>
            </div>
            <nav class="desktop-nav">
                <a href="./" class="nav-item">Home</a>
                <a href="./market.html" class="nav-item">Market</a>
                <a href="./ai-finance.html" class="nav-item">AI Finance</a>
                <a href="./loan.html" class="nav-item">Loans</a>
                <a href="./profile.html" class="nav-item">Account</a>
            </nav>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn sign-up-btn">Sign Up</button>
            <button id="nav-black-btn" class="nav-btn sign-in-btn">Sign In</button>
        </div>

        <button class="mobile-menu-toggle">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
         <a href="./" class="nav-item">Home</a>
         <a href="./market.html" class="nav-item">Market</a>
         <a href="./ai-finance.html" class="nav-item">AI Finance</a>
         <a href="./loan.html" class="nav-item">Loans</a>
         <a href="./profile.html" class="nav-item">Account</a>
        <div class="nav-buttons">
            <button class="nav-btn sign-up-btn">  Sign Up</button>
            <button id="nav-black-btn" class="nav-btn sign-in-btn">Sign In</button>
        </div>
    </nav>
  </header>

  <section class="kyc">
     <div class="kyc-container">
    <h1>KYC Verification</h1>
    <form id="kycForm" enctype="multipart/form-data">
      <div class="form-group">
        <label for="country">Country</label>
        <input id="country" name="country" type="text" required>
      </div>
      <div class="form-group">
        <label for="address">Address</label>
        <textarea id="address" name="address" rows="2" required></textarea>
      </div>
      <div class="form-group">
        <label for="monthlyIncome">Monthly Income</label>
        <input id="monthlyIncome" name="monthlyIncome" type="number" min="0" required>
      </div>
      <div class="form-group">
        <label for="expectedInvestment">Expected Investment Amount</label>
        <input id="expectedInvestment" name="expectedInvestment" type="number" min="0" required>
      </div>
      <div class="form-group">
        <label for="dateOfBirth">Date of Birth</label>
        <input id="dateOfBirth" name="dateOfBirth" type="date" required>
      </div>
      <div class="form-group">
        <label for="idType">ID Type</label>
        <select id="idType" name="idType" required>
          <option value="">Choose oneâ€¦</option>
          <option value="NID">NID</option>
          <option value="Passport">Passport</option>
          <option value="Driving License">Driving License</option>
          <option value="Residence Permit">Residence Permit</option>
        </select>
      </div>
      <div class="form-group file-group">
        <div class="file-input">
          <label for="docFront">Front of ID</label>
          <input id="docFront" name="docFront" type="file" accept="image/*" required>
          <img id="previewFront" class="preview" src="" alt="front preview" hidden>
        </div>
        <div class="file-input">
          <label for="docsBack">Back of ID</label>
          <input id="docsBack" name="docsBack" type="file" accept="image/*" required>
          <img id="previewBack" class="preview" src="" alt="back preview" hidden>
        </div>
      </div>
      <button type="submit" class="btn-submit">Submit Verification</button>
    </form>
  </div>
  </section>

   <footer class="footer">
    <div class="footer-content">
      <!-- Logo / Brand -->
      <div class="footer-section logo-section">
        <img src="./Images/logo_foot.png" alt="Global Assets Logo" class="footer-logo">
      </div>
      <!-- Company -->
      <div class="footer-section">
        <h4>Company</h4>
        <ul>
          <li><a href="./about.html">About Us</a></li>
          <li><a href="./team.html">About the Team</a></li>
          <li><a href="./faq.html">Help Center</a></li>
          <li><a href="#">Email support</a></li>
          <li><a href="mailto:service@global-assets.com">service@globalâ€‘assets.io</a></li>
        </ul>
      </div>
      <!-- Product -->
      <div class="footer-section">
        <h4>Product</h4>
        <ul>
          <li><a href="./market.html">Market List</a></li>
          <li><a href="./loan.html">Investment loans</a></li>
          <li><a href="./ai-finance.html">AI Finance</a></li>
        </ul>
      </div>
      <!-- Policy -->
      <div class="footer-section">
        <h4>Policy</h4>
        <ul>
          <li><a href="./agrt.html">User Services Agreement</a></li>
          <li><a href="./loan-agrt.html">Loan agreement</a></li>
          <li><a href="./loan-explain.html">Loan rules explanation</a></li>
          <li><a href="./legal-liability.html">Legal liability</a></li>
        </ul>
      </div>
      <!-- Statement -->
      <div class="footer-section">
        <h4>Statement</h4>
        <ul>
          <li><a href="./risk.html">Risk Warning</a></li>
          <li><a href="./privacy-statement.html">Privacy Statement</a></li>
          <li><a href="./anti-laundaring.html">Antiâ€‘Money Laundering Policy</a></li>
          <li><a href="./rglt-licence.html">Regulatory license</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      &copy; CopyrightÂ 2016Â â€“Â 2025Â GlobalÂ Assets. AllÂ rightsÂ reserved.
    </div>
  </footer>
 

  <div id="toast" class="toast"></div>

    <script src="./javascript/common-script.js"></script>
    <script src="./javascript/loing-check.js"></script>

    <script>
document.addEventListener('DOMContentLoaded', async function () {
  try {
    const res = await fetch('/api/v1/users/profile', { credentials: 'include' });
    if (!res.ok) return window.location.href = '/login.html';
    const resp = await res.json();
    const userData = resp.data;
    if (!userData.kyc || userData.kyc.status === 'unsubmitted') return;

    // Create blur overlay
    const blurOverlay = document.createElement('div');
    blurOverlay.style.position = 'fixed';
    blurOverlay.style.inset = '0';
    blurOverlay.style.zIndex = '9998';
    blurOverlay.style.backdropFilter = 'blur(8px)';
    blurOverlay.style.background = 'rgba(30, 34, 45, 0.25)';
    blurOverlay.style.pointerEvents = 'auto';

    // Create modal container
    const modal = document.createElement('div');
    modal.style.position = 'fixed';
    modal.style.top = '50%';
    modal.style.left = '50%';
    modal.style.transform = 'translate(-50%, -50%)';
    modal.style.zIndex = '9999';
    modal.style.background = 'linear-gradient(135deg, #232526 0%, #414345 100%)';
    modal.style.borderRadius = '1.2rem';
    modal.style.boxShadow = '0 8px 32px 0 rgba(31, 38, 135, 0.37)';
    modal.style.padding = '2.5rem 2rem 2rem 2rem';
    modal.style.minWidth = '340px';
    modal.style.maxWidth = '90vw';
    modal.style.display = 'flex';
    modal.style.flexDirection = 'column';
    modal.style.alignItems = 'center';
    modal.style.gap = '1.5rem';
    modal.style.color = '#fff';
    modal.style.fontFamily = 'Inter, Segoe UI, Arial, sans-serif';

    // Modal content
    modal.innerHTML = `
      <div style="display: flex; flex-direction: column; align-items: center;">
        <svg width="64" height="64" fill="none" viewBox="0 0 64 64">
          <circle cx="32" cy="32" r="32" fill="url(#grad)" />
          <path d="M20 32l8 8 16-16" stroke="#fff" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
          <defs>
            <linearGradient id="grad" x1="0" y1="0" x2="64" y2="64" gradientUnits="userSpaceOnUse">
              <stop stop-color="#43cea2"/>
              <stop offset="1" stop-color="#185a9d"/>
            </linearGradient>
          </defs>
        </svg>
        <h2 style="margin: 1.2rem 0 0.5rem 0; font-size: 1.5rem; font-weight: 700; letter-spacing: 0.01em;">
          You have already submitted your KYC
        </h2>
        <p style="font-size: 1.05rem; color: #cfd8dc; margin: 0; text-align: center;">
          Your KYC status is <b style="color:#43cea2">${userData.kyc.status.charAt(0).toUpperCase() + userData.kyc.status.slice(1)}</b>.
        </p>
      </div>
      <button id="kyc-modal-ok-btn" style="
        margin-top: 1.5rem;
        padding: 0.7rem 2.2rem;
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        background: linear-gradient(90deg, #43cea2 0%, #185a9d 100%);
        border: none;
        border-radius: 0.7rem;
        box-shadow: 0 2px 8px rgba(67,206,162,0.15);
        cursor: pointer;
        transition: background 0.2s;
      ">OK</button>
    `;

    // Prevent tabbing out of modal
    modal.tabIndex = 0;
    modal.focus();

    // Append to body
    document.body.appendChild(blurOverlay);
    document.body.appendChild(modal);

    // Prevent scrolling and interaction
    document.body.style.overflow = 'hidden';

    // Trap focus inside modal
    document.addEventListener('focus', function trapFocus(e) {
      if (!modal.contains(e.target)) {
        e.stopPropagation();
        modal.focus();
      }
    }, true);

    // OK button handler
    modal.querySelector('#kyc-modal-ok-btn').onclick = function () {
      // Clean up
      document.body.removeChild(blurOverlay);
      document.body.removeChild(modal);
      document.body.style.overflow = '';
      window.history.back();
    };

    // Prevent all pointer events outside modal
    blurOverlay.onclick = e => e.stopPropagation();
    blurOverlay.onmousedown = e => e.stopPropagation();
    blurOverlay.onpointerdown = e => e.stopPropagation();
    // Prevent ESC key from closing modal
    window.addEventListener('keydown', function escBlocker(e) {
      if (e.key === 'Escape') {
        e.preventDefault();
        e.stopPropagation();
      }
    }, true);
  } catch (err) {
    // Optionally handle error (e.g., show a message or redirect)
    // For now, do nothing
  }
});
</script>

  <script>
    const kycForm      = document.getElementById('kycForm');
    const toastEl      = document.getElementById('toast');
    const previewF     = document.getElementById('previewFront');
    const previewB     = document.getElementById('previewBack');
    const fileFront    = document.getElementById('docFront');
    const fileBack     = document.getElementById('docsBack');
  
    function showToast(msg, duration=3000) {
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      setTimeout(() => toastEl.classList.remove('show'), duration);
    }
  
    // Preview for front of ID
    fileFront.addEventListener('change', e => {
      const f = e.target.files[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = () => {
        previewF.src = r.result;
        previewF.hidden = false; // ðŸ‘ˆ Unhide the preview
      };
      r.readAsDataURL(f);
    });
  
    // Preview for back of ID
    fileBack.addEventListener('change', e => {
      const f = e.target.files[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = () => {
        previewB.src = r.result;
        previewB.hidden = false; // ðŸ‘ˆ Unhide the preview
      };
      r.readAsDataURL(f);
    });
  
    // Form submission handler
    kycForm.addEventListener('submit', async e => {
      e.preventDefault();
      const formData = new FormData(kycForm);
  
      try {
        const res = await fetch('/api/v1/users/kyc-verificaiton', {
          method: 'POST',
          credentials: 'include',
          body: formData
        });
  
        const json = await res.json();
  
        if (res.ok) {
          showToast('KYC submitted successfully!');
          kycForm.reset();
          previewF.src = previewB.src = '';
          previewF.hidden = previewB.hidden = true; // ðŸ‘ˆ Hide previews after reset
        } else {
          showToast(json.message || 'Submission failed');
        }
      } catch (err) {
        console.error(err);
        showToast('Network error, please try again');
      }
    });
  </script>
  
</body>
</html>
