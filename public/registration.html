<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helpline Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="./css/registration-new.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="./css/homepage.css">

</head>
<body>

  <header id="header">
    <div class="header-container">
        <div class="nav-menu">
            <div class="logo-container">
               <a href="./"> <img src="./Images/home_logo.png" alt="Company Logo"> </a>
            </div>
            <nav class="desktop-nav">
                <a href="./" class="nav-item">Home</a>
                <a href="./market.html" class="nav-item">Market</a>
                <a href="./ai-finance.html" class="nav-item">AI Finance</a>
                <a href="./loan.html" class="nav-item">Loans</a>
                <a href="./profile.html" class="nav-item">Account</a>
            </nav>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn sign-up-btn">Sign Up</button>
            <button id="nav-black-btn" class="nav-btn sign-in-btn">Sign In</button>
        </div>

        <button class="mobile-menu-toggle">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
         <a href="./" class="nav-item">Home</a>
         <a href="./market.html" class="nav-item">Market</a>
         <a href="./ai-finance.html" class="nav-item">AI Finance</a>
         <a href="./loan.html" class="nav-item">Loans</a>
         <a href="./profile.html" class="nav-item">Account</a>
        <div class="nav-buttons">
            <button class="nav-btn sign-up-btn">  Sign Up</button>
            <button id="nav-black-btn" class="nav-btn sign-in-btn">Sign In</button>
        </div>
    </nav>
  </header>

    <section class="registration">
      <div class="registration-container">

        <div id="step1" class="form-step">
          <div class="registration-header">
            <h2>Create Your Account</h2>
            <p class="subtitle">Join our community and get started today</p>
          </div>

          <form id="createAccountForm">
            <div class="form-group">
              <label for="email"><i class="fas fa-envelope"></i> Email Address</label>
              <div class="input-with-icon">
                <span class="input-icon"><i class="fas fa-envelope"></i></span>
                <input type="email" id="email" required placeholder="name@example.com" />
              </div>
            </div>
            
            <div class="form-group">
              <label for="password"><i class="fas fa-lock"></i> Password</label>
              <div class="input-with-icon">
                <span class="input-icon"><i class="fas fa-lock"></i></span>
                <input type="password" id="password" required placeholder="Create a strong password" />
              </div>
              <div class="password-strength">
                <div class="password-strength-bar" id="passwordStrengthBar"></div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="confirmPassword"><i class="fas fa-lock"></i> Confirm Password</label>
              <div class="input-with-icon">
                <span class="input-icon"><i class="fas fa-lock"></i></span>
                <input type="password" id="confirmPassword" required placeholder="Confirm your password" />
              </div>
              <div id="passwordMatchMessage" style="font-size: 0.8rem; margin-top: 5px; color: #f72585;"></div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="country"><i class="fas fa-globe"></i> Country</label>
                <div class="input-with-icon suggestions-container">
                  <span class="input-icon"><i class="fas fa-globe"></i></span>
                  <input type="text" id="country" required placeholder="Enter your country" />
                  <div class="suggestions-list" id="countrySuggestions"></div>
                </div>
              </div>
              <div class="form-group">
                <label for="state"><i class="fas fa-map-marker-alt"></i> State</label>
                <div class="input-with-icon suggestions-container">
                  <span class="input-icon"><i class="fas fa-map-marker-alt"></i></span>
                  <input type="text" id="state" required placeholder="Enter your state" />
                  <div class="suggestions-list" id="stateSuggestions"></div>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="inviteCode"><i class="fas fa-gift"></i> Invite Code (Optional)</label>
              <div class="input-with-icon">
                <span class="input-icon"><i class="fas fa-gift"></i></span>
                <input type="text" id="inviteCode" placeholder="Enter invite code if you have one" />
              </div>
            </div>
            
            <div class="terms-container">
              <input type="checkbox" id="terms" required />
              <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
            </div>
            
            <button type="submit" id="createAccountBtn">Create Account <i class="fas fa-arrow-right"></i></button>
          </form>
        </div>

        <div id="step2" class="form-step form-step-hidden">
          <div class="registration-header">
            <h2>Verify Your Email</h2>
            <p class="subtitle">
              We've sent a 6-digit code to <strong id="userEmailDisplay">your.email@example.com</strong>
            </p>
          </div>
          
          <form id="otpForm">
            <div class="otp-container">
              <input type="text" class="otp-input" maxlength="1" data-index="0" autocomplete="off" />
              <input type="text" class="otp-input" maxlength="1" data-index="1" autocomplete="off" />
              <input type="text" class="otp-input" maxlength="1" data-index="2" autocomplete="off" />
              <input type="text" class="otp-input" maxlength="1" data-index="3" autocomplete="off" />
              <input type="text" class="otp-input" maxlength="1" data-index="4" autocomplete="off" />
              <input type="text" class="otp-input" maxlength="1" data-index="5" autocomplete="off" />
            </div>
            
            <button type="submit" id="completeRegistrationBtn">Verify and Continue <i class="fas fa-check"></i></button>
          </form>
          
          <div class="form-footer">
            Didn't receive the code?
            <button type="button" id="resendOtpBtn" class="link-button">Resend Code</button>
          </div>
        </div>

      </div>
    </section>

   <footer class="footer">
    <div class="footer-content">
      <!-- Logo / Brand -->
      <div class="footer-section logo-section">
        <img src="./Images/logo_foot.png" alt="Global Assets Logo" class="footer-logo">
      </div>
      <!-- Company -->
      <div class="footer-section">
        <h4>Company</h4>
        <ul>
          <li><a href="./about.html">About Us</a></li>
          <li><a href="./team.html">About the Team</a></li>
          <li><a href="./faq.html">Help Center</a></li>
          <li><a href="#">Email support</a></li>
          <li><a href="mailto:service@global-assets.com">service@global‑assets.io</a></li>
        </ul>
      </div>
      <!-- Product -->
      <div class="footer-section">
        <h4>Product</h4>
        <ul>
          <li><a href="./market.html">Market List</a></li>
          <li><a href="./loan.html">Investment loans</a></li>
          <li><a href="./ai-finance.html">AI Finance</a></li>
        </ul>
      </div>
      <!-- Policy -->
      <div class="footer-section">
        <h4>Policy</h4>
        <ul>
          <li><a href="./agrt.html">User Services Agreement</a></li>
          <li><a href="./loan-agrt.html">Loan agreement</a></li>
          <li><a href="./loan-explain.html">Loan rules explanation</a></li>
          <li><a href="./legal-liability.html">Legal liability</a></li>
        </ul>
      </div>
      <!-- Statement -->
      <div class="footer-section">
        <h4>Statement</h4>
        <ul>
          <li><a href="./risk.html">Risk Warning</a></li>
          <li><a href="./privacy-statement.html">Privacy Statement</a></li>
          <li><a href="./anti-laundaring.html">Anti‑Money Laundering Policy</a></li>
          <li><a href="./rglt-licence.html">Regulatory license</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      &copy; Copyright 2016 – 2025 Global Assets. All rights reserved.
    </div>
  </footer>

    <script src="./javascript/common-script.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  'use strict';

  const API_BASE = '/api/v1/users';

  const registrationSection = document.querySelector('.registration');
  if (!registrationSection) return;

  // Elements
  const step1 = registrationSection.querySelector('#step1');
  const step2 = registrationSection.querySelector('#step2');
  const createAccountForm = registrationSection.querySelector('#createAccountForm');
  const emailInput = registrationSection.querySelector('#email');
  const userEmailDisplay = registrationSection.querySelector('#userEmailDisplay');
  const passwordInput = registrationSection.querySelector('#password');
  const confirmPasswordInput = registrationSection.querySelector('#confirmPassword');
  const passwordMatchMessage = registrationSection.querySelector('#passwordMatchMessage');
  const passwordStrengthBar = registrationSection.querySelector('#passwordStrengthBar');
  const createAccountBtn = registrationSection.querySelector('#createAccountBtn');
  const otpForm = registrationSection.querySelector('#otpForm');
  const otpInputs = Array.from(registrationSection.querySelectorAll('.otp-input'));
  const countryInput = registrationSection.querySelector('#country');
  const stateInput = registrationSection.querySelector('#state');
  const countrySuggestions = registrationSection.querySelector('#countrySuggestions');
  const stateSuggestions = registrationSection.querySelector('#stateSuggestions');
  const resendOtpBtn = registrationSection.querySelector('#resendOtpBtn');
  const completeRegistrationBtn = registrationSection.querySelector('#completeRegistrationBtn');
  const termsCheckbox = registrationSection.querySelector('#terms');
  const inviteCodeInput = registrationSection.querySelector('#inviteCode');

  // Inline message under header (step1)
  let inlineMsg = step1.querySelector('.inline-msg');
  if (!inlineMsg) {
    inlineMsg = document.createElement('div');
    inlineMsg.className = 'inline-msg';
    inlineMsg.style.margin = '8px 0';
    inlineMsg.style.fontSize = '0.95rem';
    step1.querySelector('.registration-header').after(inlineMsg);
  }
  function setMsg(text = '', type = 'info', timeout = 5000) {
    inlineMsg.textContent = text;
    inlineMsg.style.color = type === 'error' ? '#c62828' : '#1b5e20';
    if (timeout) {
      clearTimeout(setMsg._t);
      setMsg._t = setTimeout(() => { inlineMsg.textContent = ''; }, timeout);
    }
  }

  // ------------------------ Toast system (modern premium) ------------------------
  // Inject tiny style for toast UI
  const toastStyle = document.createElement('style');
  toastStyle.textContent = `
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 99999;
      pointer-events: none;
    }
    .toast {
      pointer-events: auto;
      min-width: 260px;
      max-width: 360px;
      padding: 12px 14px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(12,15,20,0.18);
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(245,245,245,0.9));
      backdrop-filter: blur(6px);
      display: flex;
      gap: 12px;
      align-items: center;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #0f172a;
      border: 1px solid rgba(15,23,42,0.06);
      transform-origin: right top;
      animation: toastIn .18s ease;
    }
    .toast .icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 18px;
      color: white;
      flex-shrink:0;
    }
    .toast .body { flex:1; }
    .toast .title { font-weight:600; font-size:0.95rem; margin-bottom:2px; }
    .toast .desc { font-size:0.86rem; opacity:0.9; }
    .toast.success .icon { background: linear-gradient(135deg,#16a34a,#22c55e); }
    .toast.error   .icon { background: linear-gradient(135deg,#dc2626,#f43f5e); }
    .toast.info    .icon { background: linear-gradient(135deg,#2563eb,#60a5fa); }
    @keyframes toastIn { from { transform: translateX(8px) scale(0.98); opacity: 0 } to { transform: translateX(0) scale(1); opacity: 1 } }
  `;
  document.head.appendChild(toastStyle);

  const toastContainer = document.createElement('div');
  toastContainer.className = 'toast-container';
  document.body.appendChild(toastContainer);

  function showToast(title, description = '', type = 'info', duration = 4000) {
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.setAttribute('role', 'status');
    t.innerHTML = `
      <div class="icon">${ type === 'success' ? '✓' : type === 'error' ? '✕' : 'i' }</div>
      <div class="body"><div class="title">${title}</div>${description ? `<div class="desc">${description}</div>` : ''}</div>
    `;
    toastContainer.appendChild(t);
    const remove = () => t.animate([{opacity:1, transform:'translateX(0)'},{opacity:0, transform:'translateX(10px)'}], {duration:180, easing:'ease'}).onfinish = () => t.remove();
    if (duration > 0) setTimeout(remove, duration);
    // give a click-to-dismiss
    t.addEventListener('click', () => {
      remove();
    });
    return t;
  }

  // ------------------------ Password strength & confirm ------------------------
  passwordInput.addEventListener('input', function () {
    const password = this.value || '';
    let strength = 0;
    if (password.length >= 8) strength += 25;
    if (/[A-Z]/.test(password)) strength += 25;
    if (/[0-9]/.test(password)) strength += 25;
    if (/[^A-Za-z0-9]/.test(password)) strength += 25;
    passwordStrengthBar.style.width = strength + '%';
    if (strength < 50) passwordStrengthBar.style.background = '#f72585';
    else if (strength < 75) passwordStrengthBar.style.background = '#ffbe0b';
    else passwordStrengthBar.style.background = '#4cc9f0';
  });
  confirmPasswordInput.addEventListener('input', function () {
    if (passwordInput.value !== this.value) {
      passwordMatchMessage.textContent = "Passwords don't match";
    } else {
      passwordMatchMessage.textContent = "";
    }
  });

  // ------------------------ Country/State suggestions ------------------------
  const countries = ['United States', 'Canada', 'United Kingdom', 'Australia', 'Germany', 'France', 'Bangladesh', 'India'];
  const states = {
    'United States': ['California', 'New York', 'Texas', 'Florida', 'Illinois'],
    'Canada': ['Ontario', 'Quebec', 'British Columbia', 'Alberta'],
    'United Kingdom': ['England', 'Scotland', 'Wales', 'Northern Ireland'],
    'Australia': ['New South Wales', 'Victoria', 'Queensland', 'Western Australia'],
    'Bangladesh': ['Dhaka', 'Chittagong', 'Rajshahi', 'Khulna'],
    'India': ['Maharashtra', 'Uttar Pradesh', 'Karnataka', 'Tamil Nadu']
  };
  countryInput.addEventListener('input', function () {
    const v = this.value.trim().toLowerCase();
    countrySuggestions.innerHTML = '';
    if (v.length > 1) {
      const filtered = countries.filter(c => c.toLowerCase().includes(v));
      if (filtered.length) {
        countrySuggestions.style.display = 'block';
        filtered.forEach(c => {
          const d = document.createElement('div');
          d.className = 'suggestion-item';
          d.textContent = c;
          d.addEventListener('click', () => {
            countryInput.value = c;
            countrySuggestions.style.display = 'none';
            stateInput.value = '';
          });
          countrySuggestions.appendChild(d);
        });
      } else countrySuggestions.style.display = 'none';
    } else countrySuggestions.style.display = 'none';
  });
  stateInput.addEventListener('input', function () {
    const v = this.value.trim().toLowerCase();
    const ctry = countryInput.value;
    stateSuggestions.innerHTML = '';
    if (v.length > 1 && states[ctry]) {
      const filtered = states[ctry].filter(s => s.toLowerCase().includes(v));
      if (filtered.length) {
        stateSuggestions.style.display = 'block';
        filtered.forEach(s => {
          const d = document.createElement('div');
          d.className = 'suggestion-item';
          d.textContent = s;
          d.addEventListener('click', () => {
            stateInput.value = s;
            stateSuggestions.style.display = 'none';
          });
          stateSuggestions.appendChild(d);
        });
      } else stateSuggestions.style.display = 'none';
    } else stateSuggestions.style.display = 'none';
  });
  document.addEventListener('click', (ev) => {
    if (!countryInput.contains(ev.target)) countrySuggestions.style.display = 'none';
    if (!stateInput.contains(ev.target)) stateSuggestions.style.display = 'none';
  });

  // ------------------------ OTP UX ------------------------
  otpInputs.forEach((input, idx) => {
    input.addEventListener('input', () => {
      if (input.value.length > 1) input.value = input.value.slice(0, 1);
      if (/\D/.test(input.value)) input.value = input.value.replace(/\D/g, '');
      if (input.value && idx < otpInputs.length - 1) otpInputs[idx + 1].focus();
    });
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace' && input.value === '' && idx > 0) otpInputs[idx - 1].focus();
      if (e.key === 'ArrowLeft' && idx > 0) otpInputs[idx - 1].focus();
      if (e.key === 'ArrowRight' && idx < otpInputs.length - 1) otpInputs[idx + 1].focus();
    });
    input.addEventListener('keypress', (e) => { if (!/\d/.test(e.key)) e.preventDefault(); });
  });

  // ------------------------ Helpers: fetch + name derive ------------------------
  async function postJson(url, data) {
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    const text = await res.text();
    let json;
    try { json = JSON.parse(text); } catch (_) { json = { message: text || res.statusText }; }
    if (!res.ok) throw new Error(json.message || `HTTP ${res.status}`);
    return json;
  }
  async function postForm(url, formData) {
    const res = await fetch(url, { method: 'POST', body: formData });
    const text = await res.text();
    let json;
    try { json = JSON.parse(text); } catch (_) { json = { message: text || res.statusText }; }
    if (!res.ok) throw new Error(json.message || `HTTP ${res.status}`);
    return json;
  }

  function deriveNameParts(email) {
    const local = (email || '').split('@')[0] || '';
    const parts = local.split(/[._\-]/).filter(Boolean);
    const first = parts[0] ? capitalize(parts[0]) : 'User';
    const last = parts[1] ? capitalize(parts[1]) : 'Anonymous';
    return { firstName: first, lastName: last };
  }
  function capitalize(s){ return s ? s.charAt(0).toUpperCase() + s.slice(1) : s; }

  function goToStep2(email) {
    userEmailDisplay.textContent = email || 'your.email@example.com';
    step1.classList.add('form-step-hidden');
    step2.classList.remove('form-step-hidden');
    setTimeout(() => { otpInputs[0].focus(); }, 250);
  }
  function goToStep1() {
    step2.classList.add('form-step-hidden');
    step1.classList.remove('form-step-hidden');
  }

  // ------------------------ Resend cooldown logic (custom: still clickable to show wait toast) ------------------------
  let resendAvailable = true;
  let resendRemaining = 0;
  let resendTimer = null;
  function startResendCooldown(seconds) {
    resendAvailable = false;
    resendRemaining = seconds;
    updateResendText();
    if (resendTimer) clearInterval(resendTimer);
    resendTimer = setInterval(() => {
      resendRemaining -= 1;
      updateResendText();
      if (resendRemaining <= 0) {
        clearInterval(resendTimer);
        resendAvailable = true;
        resendRemaining = 0;
        resendOtpBtn.textContent = 'Resend Code';
        resendOtpBtn.classList.remove('cooldown');
      }
    }, 1000);
    resendOtpBtn.classList.add('cooldown');
    // visual hint (reduced opacity)
    resendOtpBtn.style.opacity = '0.75';
  }
  function updateResendText() {
    resendOtpBtn.textContent = `Resend Code (${resendRemaining}s)`;
  }

  // ------------------------ Step1 submit -> send OTP ------------------------
  createAccountForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = (emailInput.value || '').trim();
    const password = passwordInput.value || '';
    const confirm = confirmPasswordInput.value || '';

    if (!email) { setMsg('Please enter an email.', 'error'); showToast('Missing email','Enter your email to continue','error'); emailInput.focus(); return; }
    if (password.length < 8) { setMsg('Password must be at least 8 characters.', 'error'); showToast('Weak password','Password must be at least 8 characters','error'); passwordInput.focus(); return; }
    if (password !== confirm) { passwordMatchMessage.textContent = "Passwords don't match"; showToast('Password mismatch','Confirm your password','error'); confirmPasswordInput.focus(); return; }
    if (!termsCheckbox.checked) { setMsg('You must agree to Terms of Service.', 'error'); showToast('Agree required','Please accept Terms of Service to continue','error'); return; }

    // loading state
    createAccountBtn.classList.add('button-loading');
    createAccountBtn.disabled = true;
    setMsg('Sending verification code...');

    try {
      await postJson(`${API_BASE}/send-otp`, { email });
      setMsg('OTP sent. Check your email (including spam).');
      showToast('Code sent', 'A 6-digit code has been sent to your email', 'success', 4500);
      goToStep2(email);
      startResendCooldown(30);
    } catch (err) {
      setMsg('Failed to send OTP: ' + err.message, 'error', 8000);
      showToast('Failed to send code', err.message || 'Try again', 'error', 6000);
    } finally {
      createAccountBtn.disabled = false;
      createAccountBtn.classList.remove('button-loading');
    }
  });

  // ------------------------ Resend click (always listens; shows wait toast if on cooldown) ------------------------
  resendOtpBtn.addEventListener('click', async () => {
    const email = (emailInput.value || '').trim();
    if (!email) { setMsg('Email missing. Go back and enter email.', 'error'); showToast('Email missing','Please enter your email on previous step','error'); goToStep1(); return; }

    if (!resendAvailable) {
      showToast('Please wait', `You can resend in ${resendRemaining}s`, 'info', 2500);
      return;
    }

    // proceed to resend
    try {
      showToast('Resending', 'Sending a new code to your email...', 'info', 2500);
      await postJson(`${API_BASE}/send-otp`, { email });
      showToast('Code resent', 'Check your email (including spam).', 'success', 3500);
      startResendCooldown(30);
    } catch (err) {
      showToast('Resend failed', err.message || 'Try again', 'error', 3500);
    }
  });

  // ------------------------ OTP submit -> verify & register ------------------------
  otpForm.addEventListener('submit', async (ev) => {
    ev.preventDefault();

    const otp = otpInputs.map(i => i.value.trim()).join('');
    if (otp.length !== otpInputs.length) { setMsg('Enter full verification code.', 'error'); showToast('Incomplete code','Please enter the 6-digit code', 'error'); return; }

    const email = (emailInput.value || '').trim();
    const password = passwordInput.value || '';
    const country = (countryInput.value || '').trim();
    const state = (stateInput.value || '').trim();
    const agreedToTerms = termsCheckbox.checked;

    if (!email || !password || !country || !state || !agreedToTerms) {
      setMsg('All fields (email, password, country, state, accept terms) are required before registering.', 'error', 8000);
      showToast('Missing fields','Please fill country/state and accept terms before verifying', 'error');
      return;
    }

    const { firstName, lastName } = deriveNameParts(email);

    // FormData for registration (multer)
    const formData = new FormData();
    formData.append('email', email);
    formData.append('firstName', firstName);
    formData.append('lastName', lastName);
    formData.append('password', password);
    formData.append('agreedToTerms', agreedToTerms ? 'true' : '');
    formData.append('otp', otp);
    formData.append('country', country);
    formData.append('state', state);
    if (inviteCodeInput && inviteCodeInput.value.trim()) formData.append('inviteCode', inviteCodeInput.value.trim());

    const profilePicEl = registrationSection.querySelector('input[type="file"][name="profilePic"], input#profilePic');
    if (profilePicEl && profilePicEl.files && profilePicEl.files[0]) {
      formData.append('profilePic', profilePicEl.files[0]);
    }

    // loading
    completeRegistrationBtn.classList.add('button-loading');
    completeRegistrationBtn.disabled = true;
    setMsg('Verifying code and creating account...');
    showToast('Verifying', 'Checking code and creating your account...', 'info', 3500);

    try {
      const res = await postForm(`${API_BASE}/register`, formData);
      setMsg((res && res.message) || 'Registration successful. Redirecting...');
      showToast('Welcome!', 'Registration completed successfully', 'success', 4000);
      setTimeout(() => { window.location.href = '/login.html'; }, 1200);
    } catch (err) {
      setMsg('Registration failed: ' + err.message, 'error', 9000);
      showToast('Registration failed', err.message || 'Try again', 'error', 6000);
      // remain on step2 so user can re-enter or resend
    } finally {
      completeRegistrationBtn.disabled = false;
      completeRegistrationBtn.classList.remove('button-loading');
    }
  });

  // clicking email display returns to step1 for edits
  userEmailDisplay.addEventListener('click', goToStep1);

});
</script>


</body>
</html>