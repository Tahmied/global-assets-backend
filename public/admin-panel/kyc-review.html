<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Asset admin panel</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <link rel="stylesheet" href="./styles/admin-dashboard.css">
    <style>
        /* KYC Specific Styles */
        .kyc-stats {
            margin-bottom: 2rem;
        }
        
        .kyc-list {
            display: grid;
            gap: 1.5rem;
        }
        
        .kyc-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
        }
        
        .kyc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .kyc-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .kyc-status.pending {
            background: #fef9c3;
            color: #ca8a04;
        }
        
        .kyc-content {
            display: grid;
            gap: 1.5rem;
        }
        
        .kyc-section {
            display: grid;
            gap: 1rem;
        }
        
        .kyc-info {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .kyc-info label {
            font-weight: 500;
            color: #64748b;
            min-width: 140px;
        }
        
        .id-documents {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .doc-thumbnail {
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            transition: transform 0.2s;
        }
        
        .doc-thumbnail:hover {
            transform: translateY(-2px);
        }
        
        .doc-thumbnail img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .kyc-actions {
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .approve-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .reject-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .approve-btn:hover, .reject-btn:hover {
            opacity: 0.9;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1002;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            max-width: 90%;
            max-height: 90%;
        }
        
        .close {
            position: absolute;
            top: 20px;
            right: 35px;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .kyc-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .id-documents {
                grid-template-columns: 1fr;
            }
            
            .kyc-actions {
                flex-direction: column;
            }
            
            .approve-btn, .reject-btn {
                width: 100%;
            }
        }
        
        .kyc-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.05);
}

.stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.stat-icon.pending { background: #fef9c3; color: #eab308; }
.stat-icon.approved { background: #dcfce7; color: #22c55e; }
.stat-icon.rejected { background: #fee2e2; color: #ef4444; }

.kyc-card {
    background: white;
    border-radius: 16px;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.05);
}

.kyc-card-header {
    padding: 1.5rem;
    border-bottom: 1px solid #f1f5f9;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.user-avatar {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.user-avatar img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
}

.user-info h3 {
    margin-bottom: 0.25rem;
}

.kyc-id {
    font-size: 0.9rem;
    color: #64748b;
}

.kyc-meta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.5rem;
}

.kyc-status {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.kyc-status.pending { background: #fef9c3; color: #eab308; }
.kyc-status.approved { background: #dcfce7; color: #22c55e; }
.kyc-status.rejected { background: #fee2e2; color: #ef4444; }

.kyc-card-body {
    padding: 1.5rem;
}

.kyc-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.detail-item label {
    display: block;
    color: #64748b;
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}

.detail-item p {
    font-weight: 500;
    color: var(--text);
}

.documents-section h4 {
    margin-bottom: 1rem;
}

.documents-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.document-preview {
    position: relative;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #e2e8f0;
}

.doc-thumbnail img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    display: block;
}

.doc-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: 0.2s;
}

.doc-thumbnail:hover .doc-overlay {
    opacity: 1;
}

.doc-label {
    display: block;
    padding: 0.5rem;
    text-align: center;
    font-size: 0.9rem;
    color: #64748b;
}

.kyc-card-footer {
    padding: 1.5rem;
    border-top: 1px solid #f1f5f9;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.action-buttons {
    display: flex;
    gap: 1rem;
}

.btn-success, .btn-danger, .btn-secondary {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    transition: 0.2s;
    border: none;
}

.btn-success {
    background: var(--primary);
    color: white;
}

.btn-danger {
    background: #ef4444;
    color: white;
}

.btn-secondary {
    background: #f1f5f9;
    color: var(--text);
}

/* Pagination Styles */
.pagination-container {
    margin-top: 2rem;
    display: flex;
    justify-content: center;
}

.pagination {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.pagination-item {
    padding: 0.5rem 1rem;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    background: white;
    color: var(--text);
    cursor: pointer;
    transition: 0.2s;
}

.pagination-item:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.pagination-item.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.prev-next {
    padding: 0.5rem;
}

.pagination-dots {
    padding: 0 0.5rem;
    color: #64748b;
}

/* Responsive Design */
@media (max-width: 768px) {
    .kyc-card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .kyc-meta {
        align-items: flex-start;
    }
    
    .kyc-card-footer {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .pagination {
        flex-wrap: wrap;
        justify-content: center;
    }
}

.filter-controls {
    display: flex;
    gap: 1.5rem;
    align-items: center;
    margin-top: 1.5rem;
}

.search-box {
    position: relative;
    background: white;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border: 1px solid #e2e8f0;
}

.search-box input {
    border: none;
    outline: none;
    background: transparent;
}

.filter-select {
    padding: 0.5rem;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.kyc-details-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
    
    .detail-item.full-width {
        grid-column: 1 / -1;
    }
    
    .detail-item p {
        word-break: break-word;
        line-height: 1.5;
    }
    
    .doc-thumbnail img {
        height: 200px;
    }
    
    .kyc-status.approved {
        background: #dcfce7;
        color: #22c55e;
    }
    
    .kyc-status.rejected {
        background: #fee2e2;
        color: #ef4444;
    }

    .kyc-details-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }
    
    .detail-item.full-width {
        grid-column: 1 / -1;
    }
    
    .detail-item p {
        word-break: break-word;
        line-height: 1.5;
        color: #334155;
    }
    
    .detail-item label {
        color: #64748b;
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
        display: block;
    }
    
    .doc-thumbnail img {
        height: 200px;
        object-fit: cover;
    }
    
    .kyc-status {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .kyc-status.pending {
        background: #fef9c3;
        color: #eab308;
    }
    
    .kyc-status.approved {
        background: #dcfce7;
        color: #22c55e;
    }
    
    .kyc-status.rejected {
        background: #fee2e2;
        color: #ef4444;
    }
    
    /* Notification Styles */
    .notifications-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .notification {
        padding: 1rem 1.5rem;
        border-radius: 8px;
        background: white;
        box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 1rem;
        transform: translateY(-20px);
        opacity: 0;
        animation: slideIn 0.3s forwards;
        border-left: 4px solid transparent;
    }

    .notification-success {
        border-color: #22c55e;
        background: #f0fdf4;
        color: #166534;
    }

    .notification-error {
        border-color: #ef4444;
        background: #fef2f2;
        color: #991b1b;
    }

    @keyframes slideIn {
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .notification-icon {
        font-size: 1.2rem;
    }
        </style>
</head>
<body>
    <button class="menu-btn" id="menuToggle">
        <ion-icon name="menu"></ion-icon>
    </button>

    <div class="sidebar" id="sidebar">
        <div class="logo">
            <ion-icon name="rocket"></ion-icon>
           <a href="./admin.html">Global Assets</a> 
        </div>
        <div id="dashboard" class="nav-item ">
            <ion-icon name="speedometer"></ion-icon>
           <a href="./admin.html">Dashboard</a> 
        </div>
        <div id="users" class="nav-item">
            <ion-icon name="people"></ion-icon>
          <a href="./user-management.html">Users</a>  
        </div>
        <div id="transaction" class="nav-item">
            <ion-icon name="cash"></ion-icon>
           <a href="./transactions.html">Transactions</a> 
        </div>
        <div id="kyc-review" class="nav-item active">
            <ion-icon name="document"></ion-icon>
           <a href="./kyc-review.html">KYC Review</a> 
        </div>
        <div id="loan-review" class="nav-item">
            <ion-icon name="card"></ion-icon>
            <a href="./loan-review.html">Loan Requests</a>
        </div>
        <div id="settings" class="nav-item">
            <ion-icon name="settings"></ion-icon>
           <a href="./settings.html">Settings</a> 
        </div>
        <div id="announcement" class="nav-item">
            <ion-icon name="megaphone"></ion-icon>
            <a href="./announcement.html">Publish Announcement</a>
        </div>
         <div id="announcement" class="nav-item">
            <ion-icon name="trending-up-outline"></ion-icon>
            <a href="./trades.html">Trades</a>
        </div>
         <div id="chats" class="nav-item">
             <ion-icon name="chatbubble"></ion-icon>
            <a href="./chat.html">Chats</a>
        </div>
    </div>

<div class="main-content">
        <div class="header">
            <h1>KYC Review</h1>
            <div class="filter-controls">
                <div class="filter-group">
                    <label>Filter by:</label>
                    <select class="filter-select">
                        <option>All</option>
                        <option>Pending</option>
                        <option>Approved</option>
                        <option>Rejected</option>
                    </select>
                </div>
                <div class="search-box">
                    <ion-icon name="search"></ion-icon>
                    <input type="text" placeholder="Search users...">
                </div>
            </div>
        </div>
    
        <div class="kyc-stats-grid">
            <div class="stat-card active">
                <div class="stat-icon pending">
                    <ion-icon name="time"></ion-icon>
                </div>
                <div class="stat-info">
                    <div class="stat-title">Pending</div>
                    <div id="pending-num" class="stat-value">Loading</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon approved">
                    <ion-icon name="checkmark-circle"></ion-icon>
                </div>
                <div class="stat-info">
                    <div class="stat-title">Approved</div>
                    <div id="approved-num" class="stat-value">Loading</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon rejected">
                    <ion-icon name="close-circle"></ion-icon>
                </div>
                <div class="stat-info">
                    <div class="stat-title">Rejected</div>
                    <div id="rejected-num" class="stat-value">Loading</div>
                </div>
            </div>
        </div>
    
        <div class="kyc-list">
      <!-- kyc list will be populated here -->
        </div>
    
        <!-- Pagination -->
        <div class="pagination-container">
            <div class="pagination">
                <button class="pagination-item prev-next">
                    <ion-icon name="chevron-back"></ion-icon>
                </button>
                <button class="pagination-item active">1</button>
                <button class="pagination-item">2</button>
                <button class="pagination-item">3</button>
                <span class="pagination-dots">...</span>
                <button class="pagination-item">8</button>
                <button class="pagination-item prev-next">
                    <ion-icon name="chevron-forward"></ion-icon>
                </button>
            </div>
        </div>
    
        <!-- Notification Container -->
        <div class="notifications-container"></div>

</div>
    
    
    <script src="admin-common.js"></script>
    <script>
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');

        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });

        // Navigation Active State
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });
        document.querySelector('#users').addEventListener('click' , (e)=>{
            e.preventDefault()
            window.location.href = './user-management.html'
        })
        document.querySelector('#transaction').addEventListener('click' , (e)=>{
            e.preventDefault()
            window.location.href = './transactions.html'
        })
        document.querySelector('#dashboard').addEventListener('click' , (e)=>{
            e.preventDefault()
            window.location.href = '/admin-panel/admin.html'
        })

        document.querySelector('#settings').addEventListener('click' , (e)=>{
            e.preventDefault()
            window.location.href = '/admin-panel/settings.html'
        })
    </script>
    <script>
function showNotification(message, type) {
    const container = document.querySelector('.notifications-container');
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <ion-icon class="notification-icon" 
            name="${type === 'success' ? 'checkmark-circle' : 'close-circle'}">
        </ion-icon>
        ${message}
    `;
    
    container.appendChild(notification);
    
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Document preview functionality
document.querySelectorAll('.doc-thumbnail').forEach(thumb => {
    thumb.addEventListener('click', function(e) {
        if(e.target.closest('ion-icon')) return;
        
        const imgSrc = this.querySelector('img').src;
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
            <span class="close">&times;</span>
            <img class="modal-content" src="${imgSrc}">
        `;
        document.body.appendChild(modal);
        
        modal.querySelector('.close').addEventListener('click', () => {
            modal.remove();
        });
    });
});
    </script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
      const kycListEl = document.querySelector('.kyc-list');
      const statsCards = document.querySelectorAll('.stat-card');
      const filterSelect = document.querySelector('.filter-select');
      const paginationEl = document.querySelector('.pagination');
      
      // State management
      let currentStatus = 'pending';
      let currentPage = 1;
      const limit = 5;

      // Initialize UI
      filterSelect.value = 'Pending';
      document.querySelector('.stat-card').classList.add('active');

      // Path formatting helper
      function formatPath(p) {
        return '/' + p.split('\\').join('/').replace(/^public\//, '');
      }

      // Fetch submissions with dynamic filtering
      async function fetchSubmissions(page) {
        let url = `/api/v1/admin/kyc-submissions?page=${page}&limit=${limit}`;
        if (currentStatus !== 'all') {
          url += `&status=${currentStatus}`;
        }

        const res = await fetch(url);
        const json = await res.json();
        return json.data;
      }

      // Render KYC list
      function renderList(submissions) {
        kycListEl.innerHTML = '';
        submissions.forEach(sub => {
          const daysAgo = Math.floor((Date.now() - new Date(sub.createdAt)) / (1000 * 60 * 60 * 24));
          const frontSrc = formatPath(sub.idFrontImage);
          const backSrc = formatPath(sub.idBackImage);

          const card = document.createElement('div');
          card.className = 'kyc-card';
          card.dataset.userId = sub.userId;
          
          card.innerHTML = `
            <div class="kyc-card-header">
              <div class="user-avatar">
                <div class="user-info">
                  <h3>${sub.fullName}</h3>
                </div>
              </div>
              <div class="kyc-meta">
                <span class="kyc-date">
                  Submitted: ${daysAgo} day${daysAgo !== 1 ? 's' : ''} ago
                </span>
                <span class="kyc-status ${sub.status}">
                  <ion-icon name="${
                    sub.status === 'approved' ? 'checkmark-circle' :
                    sub.status === 'rejected' ? 'close-circle' : 'time'
                  }"></ion-icon>
                  ${sub.status.charAt(0).toUpperCase() + sub.status.slice(1)}
                </span>
              </div>
            </div>
            <div class="kyc-card-body">
              <div class="kyc-details-grid">
                <div class="detail-item"><label>Country</label><p>${sub.country}</p></div>
                <div class="detail-item"><label>Date of Birth</label><p>${new Date(sub.dateOfBirth).toLocaleDateString()}</p></div>
                <div class="detail-item"><label>ID Type</label><p>${sub.idType}</p></div>
                <div class="detail-item"><label>Monthly Income</label><p>$${sub.monthlyIncome.toLocaleString()}</p></div>
                <div class="detail-item"><label>Expected Investment</label><p>$${sub.expectedInvestment.toLocaleString()}</p></div>
                <div class="detail-item full-width"><label>Address</label><p>${sub.address}</p></div>
              </div>
              <div class="documents-section">
                <h4>Identity Documents</h4>
                <div class="documents-grid">
                  <div class="document-preview">
                    <div class="doc-thumbnail">
                      <img src="${frontSrc}" alt="ID Front">
                      <div class="doc-overlay"><ion-icon name="expand"></ion-icon></div>
                    </div>
                    <span class="doc-label">Front Side</span>
                  </div>
                  <div class="document-preview">
                    <div class="doc-thumbnail">
                      <img src="${backSrc}" alt="ID Back">
                      <div class="doc-overlay"><ion-icon name="expand"></ion-icon></div>
                    </div>
                    <span class="doc-label">Back Side</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="kyc-card-footer">
              <div class="action-buttons">
                <button class="btn-success"><ion-icon name="checkmark"></ion-icon> Approve</button>
                <button class="btn-danger"><ion-icon name="close"></ion-icon> Reject</button>
              </div>
            </div>
          `;

          const approveBtn = card.querySelector('.btn-success');
          const rejectBtn = card.querySelector('.btn-danger');
          approveBtn.dataset.userid = sub._id;
          rejectBtn.dataset.userid = sub._id;

          approveBtn.addEventListener('click', () => handleDecision('approved', approveBtn));
          rejectBtn.addEventListener('click', () => handleDecision('rejected', rejectBtn));

          kycListEl.appendChild(card);
        });
      }

      // Render pagination controls
      function renderPagination(lastPage) {
        paginationEl.innerHTML = '';
        const prev = document.createElement('button');
        prev.className = 'pagination-item prev-next';
        prev.innerHTML = '<ion-icon name="chevron-back"></ion-icon>';
        prev.disabled = currentPage === 1;
        paginationEl.appendChild(prev);

        for (let i = 1; i <= lastPage; i++) {
          const btn = document.createElement('button');
          btn.className = `pagination-item ${i === currentPage ? 'active' : ''}`;
          btn.textContent = i;
          paginationEl.appendChild(btn);
        }

        const next = document.createElement('button');
        next.className = 'pagination-item prev-next';
        next.innerHTML = '<ion-icon name="chevron-forward"></ion-icon>';
        next.disabled = currentPage === lastPage;
        paginationEl.appendChild(next);
      }

      // Update data and UI
      async function update() {
        const data = await fetchSubmissions(currentPage);
        renderList(data.submissions);
        renderPagination(data.lastPage);
      }

      // Stats cards click handler
      statsCards.forEach(card => {
        card.addEventListener('click', () => {
          statsCards.forEach(c => c.classList.remove('active'));
          card.classList.add('active');
          currentStatus = card.querySelector('.stat-title').textContent.toLowerCase();
          currentPage = 1;
          filterSelect.value = currentStatus.charAt(0).toUpperCase() + currentStatus.slice(1);
          update();
        });
      });

      // Dropdown filter handler
      filterSelect.addEventListener('change', e => {
        currentStatus = e.target.value.toLowerCase();
        currentPage = 1;
        
        statsCards.forEach(c => {
          const cardStatus = c.querySelector('.stat-title').textContent.toLowerCase();
          c.classList.toggle('active', cardStatus === currentStatus);
        });
        
        if (currentStatus === 'all') {
          statsCards.forEach(c => c.classList.remove('active'));
        }
        
        update();
      });

      // Pagination click handler
      paginationEl.addEventListener('click', e => {
        if (!e.target.closest('.pagination-item') || e.target.disabled) return;
        const btn = e.target.closest('button');
        
        if (btn.classList.contains('prev-next')) {
          currentPage += btn.querySelector('ion-icon').getAttribute('name') === 'chevron-back' ? -1 : 1;
        } else {
          currentPage = Number(btn.textContent);
        }
        
        update();
      });

      // Approve/Reject handler
      async function handleDecision(status, button) {
        const card = button.closest('.kyc-card');
        const userId = card.dataset.userId;

        card.querySelectorAll('.btn-success, .btn-danger').forEach(b => b.disabled = true);

        try {
          const res = await fetch('/api/v1/admin/set-kyc-status', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ status, userId })
          });

          const json = await res.json();
          if (!res.ok) throw new Error(json.message || 'Update failed');

          const statusEl = card.querySelector('.kyc-status');
          statusEl.className = `kyc-status ${status}`;
          statusEl.innerHTML = `
            <ion-icon name="${status === 'approved' ? 'checkmark-circle' : 'close-circle'}"></ion-icon>
            ${status.charAt(0).toUpperCase() + status.slice(1)}
          `;

          showNotification(json.message || 'Status updated', 'success');
          update();
        } catch (err) {
          showNotification(err.message, 'error');
        } finally {
          card.querySelectorAll('.btn-success, .btn-danger').forEach(b => b.disabled = false);
        }
      }

      // Initial load
      update();
    });
</script>

    <script>
        // Enhanced Document Preview with Full Image Modal
        document.querySelector('.kyc-list').addEventListener('click', function(e) {
            const thumbnail = e.target.closest('.doc-thumbnail');
            if (!thumbnail) return;
            
            const imgElement = thumbnail.querySelector('img');
            const imgSrc = imgElement.src;
            
            // Create modal elements
            const modal = document.createElement('div');
            modal.className = 'image-modal';
            
            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content';
            
            const closeBtn = document.createElement('span');
            closeBtn.className = 'close-modal';
            closeBtn.innerHTML = '&times;';
            
            const fullImage = document.createElement('img');
            fullImage.src = imgSrc;
            fullImage.alt = 'Full Document Preview';
            
            // Build modal structure
            modalContent.appendChild(closeBtn);
            modalContent.appendChild(fullImage);
            modal.appendChild(modalContent);
            
            // Add to DOM
            document.body.appendChild(modal);
            document.body.classList.add('modal-open');
        
            // Close handlers
            function closeModal() {
                modal.remove();
                document.body.classList.remove('modal-open');
            }
        
            closeBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });
            
            // Keyboard close
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
            });
        });
        
        // Add this CSS for the modal
        const style = document.createElement('style');
        style.textContent = `
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            cursor: zoom-out;
        }
        
        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .image-modal img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            display: block;
            margin: 0 auto;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            color: white;
            font-size: 35px;
            cursor: pointer;
            z-index: 1;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        body.modal-open {
            overflow: hidden;
        }
        `;
        document.head.appendChild(style);
        </script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const response = await fetch('/api/v1/admin/kyc-states');
        const result = await response.json();
  
        if (result.success && result.data) {
          const { pending, approved, rejected } = result.data;
  
          // Update the DOM elements
          document.getElementById('pending-num').textContent = pending ?? 0;
          document.getElementById('approved-num').textContent = approved ?? 0;
          document.getElementById('rejected-num').textContent = rejected ?? 0;
        } else {
          console.error('Failed to load KYC stats:', result.message);
        }
      } catch (error) {
        console.error('Error fetching KYC status data:', error);
      }
    });
  </script>
  
</body>
</html>