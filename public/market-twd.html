<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market - Global Assets</title>
    <link rel="stylesheet" href="./css/homepage.css">
    <link rel="stylesheet" href="./css/market.css">
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-p8fYCL5NYUphkSJQ5tVZfOrHAIcLVc9oPUS1v64XU"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<header id="header">
    <div class="header-container">
        <div class="nav-menu">
            <div class="logo-container">
               <a href="./"> <img src="./Images/home_logo.png" alt="Company Logo"> </a>
            </div>
            <nav class="desktop-nav">
                <a href="./" class="nav-item">Home</a>
                <a href="./market.html" class="nav-item">Market</a>
                <a href="./ai-finance.html" class="nav-item">AI Finance</a>
                <a href="./loan.html" class="nav-item">Loans</a>
                <a href="./profile.html" class="nav-item">Account</a>
            </nav>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn sign-up-btn">Sign Up</button>
            <button id="nav-black-btn" class="nav-btn sign-in-btn">Sign In</button>
        </div>

        <button class="mobile-menu-toggle">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
         <a href="./" class="nav-item">Home</a>
         <a href="./market.html" class="nav-item">Market</a>
         <a href="./ai-finance.html" class="nav-item">AI Finance</a>
         <a href="./loan.html" class="nav-item">Loans</a>
         <a href="./profile.html" class="nav-item">Account</a>
        <div class="nav-buttons">
            <button class="nav-btn sign-up-btn">  Sign Up</button>
            <button id="nav-black-btn" class="nav-btn sign-in-btn">Sign In</button>
        </div>
    </nav>
  </header>

    <main class="market-container">
        <!-- Filter Section -->
        <div class="asset-filters">
            <button class="filter-btn">Favorites</button>
            <button class="filter-btn active">Forex</button>
            <button class="filter-btn">Digital Assets</button>
            <button class="filter-btn">Stock</button>
            <button class="filter-btn">ETF</button>
        </div>

        <!-- Top Assets Grid -->
<div class="top-assets-grid">
    <!-- BTC Card -->
    <article class="asset-card">
        <div class="asset-header">
            <img src="./Images/btc-icon.svg" alt="BTC" class="asset-icon">
            <div>
                <div class="asset-name">BTC/USDT</div>
                <div class="asset-price">$95,232.99</div>
            </div>
        </div>
        <div class="asset-info">
            <div class="asset-change negative">▼ 1.05%</div>
            <div class="card-chart-container">
                <canvas class="mkt-sparkline" 
                        data-values="95.5,96,95,96.5,97,96,95,94.5,95,94"
                        data-positive="false"></canvas>
            </div>
        </div>
    </article>

    <!-- ETH Card -->
    <article class="asset-card">
        <div class="asset-header">
            <img src="./Images/eth-icon.svg" alt="ETH" class="asset-icon">
            <div>
                <div class="asset-name">ETH/USDT</div>
                <div class="asset-price">$1,824.74</div>
            </div>
        </div>
        <div class="asset-info">
            <div class="asset-change negative">▼ 0.71%</div>
            <div class="card-chart-container">
                <canvas class="mkt-sparkline"
                        data-values="1820,1815,1824,1828,1830,1825,1820,1818,1820,1824"
                        data-positive="false"></canvas>
            </div>
        </div>
    </article>

    <!-- XRP Card -->
    <article class="asset-card">
        <div class="asset-header">
            <img src="./Images/xrp-icon.svg" alt="XRP" class="asset-icon">
            <div>
                <div class="asset-name">XRP/USDT</div>
                <div class="asset-price">$2.1702</div>
            </div>
        </div>
        <div class="asset-info">
            <div class="asset-change positive">▲ 0.50%</div>
            <div class="card-chart-container">
                <canvas class="mkt-sparkline"
                        data-values="2.15,2.16,2.17,2.18,2.17,2.165,2.16,2.155,2.16,2.17"
                        data-positive="true"></canvas>
            </div>
        </div>
    </article>
</div>

        <!-- Market Table -->
        <div class="market-table">
            <div class="table-header">
                <div>Name</div>
                <div>24h %</div>
                <div>Chart</div>
                <div>Price</div>
            </div>

            <!-- Table Rows -->
            <div class="table-row">
                <div class="asset-name-cell">
                    <img src="./Images/btc-icon.svg" alt="BTC" class="asset-icon">
                    <span>BTC/USDT</span>
                </div>
                <div class="negative">▼ 1.05%</div>
                <div class="chart-container">
                    <canvas class="mkt-sparkline" 
                            data-values="95.5,96,95,96.5,97,96,95,94.5,95,94"
                            data-positive="false"></canvas>
                </div>
                <div>$95,232.99</div>
            </div>

            <div class="table-row">
                <div class="asset-name-cell">
                    <img src="./Images/eth-icon.svg" alt="ETH" class="asset-icon">
                    <span>ETH/USDT</span>
                </div>
                <div class="negative">▼ 0.71%</div>
                <div class="chart-container">
                    <canvas class="mkt-sparkline"
                            data-values="1820,1815,1824,1828,1830,1825,1820,1818,1820,1824"
                            data-positive="false"></canvas>
                </div>
                <div>$1,824.74</div>
            </div>

            <div class="table-row">
                <div class="asset-name-cell">
                    <img src="./Images/xrp-icon.svg" alt="XRP" class="asset-icon">
                    <span>XRP/USDT</span>
                </div>
                <div class="positive">▲ 0.50%</div>
                <div class="chart-container">
                    <canvas class="mkt-sparkline"
                            data-values="2.15,2.16,2.17,2.18,2.17,2.165,2.16,2.155,2.16,2.17"
                            data-positive="true"></canvas>
                </div>
                <div>$2.1702</div>
            </div>

            <div class="table-row">
                <div class="asset-name-cell">
                    <img src="./Images/trx-icon.svg" alt="TRX" class="asset-icon">
                    <span>TRX/USDT</span>
                </div>
                <div class="positive">▲ 0.32%</div>
                <div class="chart-container">
                    <canvas class="mkt-sparkline"
                            data-values="0.24,0.245,0.246,0.247,0.248,0.247,0.246,0.245,0.246,0.2465"
                            data-positive="true"></canvas>
                </div>
                <div>$0.2465</div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <button class="page-btn">← Previous</button>
            <button class="page-btn active">1</button>
            <button class="page-btn">2</button>
            <button class="page-btn">3</button>
            <button class="page-btn">4</button>
            <button class="page-btn">Next →</button>
        </div>
    </main>

    <!-- footer -->

    <footer class="footer">
        <div class="footer-content">
          <!-- Logo / Brand -->
          <div class="footer-section logo-section">
            <img src="./Images/logo_foot.png" alt="Global Assets Logo" class="footer-logo">
          </div>
          <!-- Company -->
          <div class="footer-section">
            <h4>Company</h4>
            <ul>
              <li><a href="#">About Us</a></li>
              <li><a href="./team.html">About the Team</a></li>
              <li><a href="#">Help Center</a></li>
              <li><a href="#">Email support</a></li>
              <li><a href="mailto:service@global-assets.com">service@global‑assets.io</a></li>
            </ul>
          </div>
          <!-- Product -->
          <div class="footer-section">
            <h4>Product</h4>
            <ul>
              <li><a href="#">Market List</a></li>
              <li><a href="#">Investment loans</a></li>
              <li><a href="#">AI Finance</a></li>
            </ul>
          </div>
          <!-- Policy -->
          <div class="footer-section">
            <h4>Policy</h4>
            <ul>
              <li><a href="#">User Services Agreement</a></li>
              <li><a href="#">Loan agreement</a></li>
              <li><a href="#">Loan rules explanation</a></li>
              <li><a href="#">Legal liability</a></li>
            </ul>
          </div>
          <!-- Statement -->
          <div class="footer-section">
            <h4>Statement</h4>
            <ul>
              <li><a href="#">Risk Warning</a></li>
              <li><a href="#">Privacy Statement</a></li>
              <li><a href="#">Anti‑Money Laundering Policy</a></li>
              <li><a href="./rglt-licence.html">Regulatory license</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          &copy; Copyright 2016 – 2025 Global Assets. All rights reserved.
        </div>
      </footer>
      
      
    
    
    <script src="./javascript/common-script.js"></script>
    <script>
        (() => {
          const API_URL = '/api/v1/market/get-twd-assets';
          const rowsPerPage = 10;
          let currentCategory = 'Forex';
          let currentPage = 1;
          let totalPages = 1;
        
          // 1) Sparkline drawer (same as before)
          function drawSparkline(canvas, values, positive) {
            const ctx = canvas.getContext('2d'),
                  w   = canvas.width,
                  h   = canvas.height,
                  min = Math.min(...values),
                  max = Math.max(...values),
                  range = max - min || 1;
            ctx.clearRect(0, 0, w, h);
            ctx.beginPath();
            values.forEach((v, i) => {
              const x = (i / (values.length - 1)) * w;
              const y = h - ((v - min) / range) * h;
              i ? ctx.lineTo(x, y) : ctx.moveTo(x, y);
            });
            ctx.strokeStyle = positive ? '#26a69a' : '#ef5350';
            ctx.lineWidth   = 1.5;
            ctx.stroke();
          }
        
          // 2) Render top‐3 cards
          function renderTop(assets) {
            const grid = document.querySelector('.top-assets-grid');
            grid.innerHTML = '';
            assets.slice(0, 3).forEach(asset => {
              const card = document.createElement('article');
              card.className = 'asset-card';
              card.innerHTML = `
                <div class="asset-header">
                  <img
                    src="${asset.logo_url || './Images/default-icon.svg'}"
                    alt="${asset.display_name}"
                    class="asset-icon"
                  >
                  <div>
                    <div class="asset-name">${asset.display_name}</div>
                    <div class="asset-price">$${asset.current_price}</div>
                  </div>
                </div>
                <div class="asset-info">
                  <div class="asset-change ${asset.sparkline_positive ? 'positive' : 'negative'}">
                    ${asset.sparkline_positive ? '▲' : '▼'} ${asset.price_change_24h_percent}%
                  </div>
                  <div class="card-chart-container">
                    <canvas class="mkt-sparkline" width="100" height="30"></canvas>
                  </div>
                </div>`;
              grid.appendChild(card);
        
              const canvas = card.querySelector('canvas');
              drawSparkline(canvas, asset.sparkline_values, asset.sparkline_positive);
            });
          }
        
          // 3) Render full table
          function renderTable(assets) {
            const table = document.querySelector('.market-table');
            // remove any existing rows
            table.querySelectorAll('.table-row').forEach(r => r.remove());
        
            assets.forEach(asset => {
              const row = document.createElement('div');
              row.className = 'table-row';
              row.innerHTML = `
                <div class="asset-name-cell">
                  <img
                    src="${asset.logo_url || './Images/default-icon.svg'}"
                    alt="${asset.display_name}"
                    class="asset-icon"
                  >
                  <span>${asset.display_name}</span>
                </div>
                <div class="${asset.sparkline_positive ? 'positive' : 'negative'}">
                  ${asset.sparkline_positive ? '▲' : '▼'} ${asset.price_change_24h_percent}%
                </div>
                <div class="chart-container">
                  <canvas class="mkt-sparkline" width="100" height="30"></canvas>
                </div>
                <div>$${asset.current_price}</div>`;
              table.appendChild(row);
        
              const canvas = row.querySelector('canvas');
              drawSparkline(canvas, asset.sparkline_values, asset.sparkline_positive);
            });
          }
        
          // 4) Render pagination controls
          function renderPagination() {
            const container = document.querySelector('.pagination');
            container.innerHTML = '';
        
            function makeBtn(label, page) {
              const btn = document.createElement('button');
              btn.className = 'page-btn' + (page === currentPage ? ' active' : '');
              btn.textContent = label;
              btn.dataset.page = page;
              if (page < 1 || page > totalPages) btn.disabled = true;
              return btn;
            }
        
            container.appendChild(makeBtn('← Previous', currentPage - 1));
        
            // show up to 3 page numbers around current
            let start = Math.max(1, currentPage - 1);
            let end   = Math.min(totalPages, start + 2);
        
            if (end - start < 2) {
              start = Math.max(1, end - 2);
            }
        
            for (let p = start; p <= end; p++) {
              container.appendChild(makeBtn(p, p));
            }
        
            if (end < totalPages) {
              const ell = document.createElement('span');
              ell.textContent = '...';
              ell.className = 'ellipsis';
              container.appendChild(ell);
              container.appendChild(makeBtn(totalPages, totalPages));
            }
        
            container.appendChild(makeBtn('Next →', currentPage + 1));
          }
        
          // 5) Load & display one page from your backend
          async function loadPage(category, page = 1) {
            currentCategory = category;
            currentPage     = page;
        
            // toggle active class on filters
            document.querySelectorAll('.filter-btn')
              .forEach(b => b.classList.toggle('active', b.textContent === category));
        
            const url = `${API_URL}?category=${encodeURIComponent(category)}&page=${page}&limit=${rowsPerPage}`;
            try {
              const res  = await fetch(url);
              const json = await res.json();
              const { assets, totalPages: tp } = json.data;
        
              totalPages = tp;
              renderTop(assets);
              renderTable(assets);
              renderPagination();
            } catch (err) {
              console.error('Failed to load assets:', err);
            }
          }
        
          // 6) Init & event listeners
          document.addEventListener('DOMContentLoaded', () => {
            loadPage('Forex', 1);
          });
        
          document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              if (!btn.classList.contains('active')) {
                loadPage(btn.textContent, 1);
              }
            });
          });
        
          document.querySelector('.pagination').addEventListener('click', e => {
            if (
              e.target.classList.contains('page-btn') &&
              !e.target.disabled
            ) {
              loadPage(currentCategory, Number(e.target.dataset.page));
            }
          });
        })();
        </script>
        
    
    
    
        
</body>
</html>